@model SmartSchool.Models.Attendance.Attendances
@{
    ViewBag.Title = "Add Attendance";
    Layout = "~/Views/Shared/_Layout.cshtml";
    Languges CurrentLanguage = ViewBag.CurrentLanguage;
    string pull = "";
    string modalpositon = "";
    string buttonpositon = "";
    string textalign = "";
    if (CurrentLanguage == Languges.English)
    {
        pull = "pull-left";
        modalpositon = "left";
        buttonpositon = "left";
        textalign = "left";
    }
    else
    {
        pull = "pull-right";
        textalign = "right";
        modalpositon = "left";
        buttonpositon = "right";

    }
}

<style>
    .row{
        margin:10px;
    }

    input[type=checkbox], input[type=radio] {
        margin-left: 5px;
        margin-right: 5px;
        margin-top: -5px;
        line-height: normal;
        float: inherit;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<div class="head-body-col">
    <span>
        <!-- back  icon-->
        <a onclick="goBack()" id="back" style="color:#fff"><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
    </span>
    <h2>@R.GetResource("AddAttendance")</h2>
</div>

<div class="inner-Container">
    <div class="light-component inner">
        <div class="inner-body-holder-forms">
            <div class="col-md-12">
                <form id="AddClassRoom" enctype="multipart/form-data" class="padding">
                    @Html.HiddenFor(model => model.StudentID, new { id = "StudentID" })
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="date" class="required">@R.GetResource("Date")</label>
                                <input type="date" id="date" class="form-control" placeholder="dd/MM/yyyy" value="@DateTime.Now.ToString("yyyy-MM-dd")">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("AttendanceType")</label>
                                <div class="form-control-wrapper">
                                    @Html.DropDownListFor(m => m.AttendanceType, Model.AttendanceTypeTextName, @R.GetResource("SelectAttendanceType"), new { @class = "form-control  select2", id = "AttendanceType", required = "required" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("AbsenceReason")</label>
                                <div class="form-control-wrapper">
                                    @Html.DropDownListFor(m => m.AbsenceReason, Model.AbsenceReasonTextName, @R.GetResource("SelectAbsenceReason"), new { @class = "form-control  select2", id = "AbsenceReason", required = "required" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("Description")</label>
                                <div class="form-control-wrapper">
                                    @Html.TextAreaFor(model => model.Description, new { @class = "form-control", id = "Description", required = "required" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <label>@R.GetResource("ParentInform")</label>
                        </div>
                        <div class="col-md-1">
                            @Html.CheckBoxFor(model => model.ParentInformed, new { id = "ParentInformed", required = "required", style = "cursor: pointer; transform: scale(1.7); margin-left:10px; margin-right:10px;" })
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("ParentMessage")</label>
                                <div class="form-control-wrapper">
                                    @Html.TextAreaFor(model => model.ParentMessage, new { @class = "form-control", id = "ParentMessage", required = "required" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("AttendanceNote")</label>
                                <div class="form-control-wrapper">
                                    @Html.TextAreaFor(model => model.AttendanceNote, new { @class = "form-control", id = "AttendanceNote", required = "required" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <label style="font-size:larger">@R.GetResource("Selecttheclassesattended:")</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("FirstSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.FirstSession, new { id = "FirstSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("SecondSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.SecondSession, new { id = "SecondSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("ThirdSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.ThirdSession, new { id = "ThirdSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("FourthSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.FourthSession, new { id = "FourthSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("FifthSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.FifthSession, new { id = "FifthSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("SixthSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.SixthSession, new { id = "SixthSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("SeventhSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.SeventhSession, new { id = "SeventhSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>@R.GetResource("EighthSession")</label>
                                <div class="form-control-wrapper">
                                    @Html.CheckBoxFor(model => model.EighthSession, new { id = "EighthSession", required = "required", style = "cursor:pointer; transform:scale(1.7); margin-left:10px;" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <button class="btnsavedit btn btn-primary-custom" id="btnsave" style="padding:10px 20px;" type="button">@R.GetResource("Save")</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    $(document).ready(function () {
        
        $(".btnsavedit").on("click", function () {
            var isValid = true;
            if ($("#AttendanceType").val() == "") {
                isValid = false;
                Swal.fire(
                    'Information',
                    'الرجاء إختيار نوع الحضور',
                    'info'
                );
            }
            if ($("#AbsenceReason").val() == "" && ($("#AttendanceType").val() == "2" || $("#AttendanceType").val() == "3")) {
                isValid = false;
                Swal.fire(
                    'Information',
                    'الرجاء إختيار سبب التغيب',
                    'info'
                );
            }
            debugger;
            if (isValid) {
                var formData = new FormData();
                var StudentID = $("#StudentID").val();
                var AttendanceDate = formatDate($('#date').val());
                var AttendanceType = $("#AttendanceType").val();
                var AbsenceReason = $("#AbsenceReason").val();
                var Description = $("#Description").val();
                var ParentInformed = $("#ParentInformed:checked").val() ? 1 : 0;
                var ParentMessage = $("#ParentMessage").val();
                var AttendanceNote = $("#AttendanceNote").val();
                var FirstSession = $("#FirstSession:checked").val() ? 1 : 0;
                var SecondSession = $("#SecondSession:checked").val() ? 1 : 0;
                var ThirdSession = $("#ThirdSession:checked").val() ? 1 : 0;
                var FourthSession = $("#FourthSession:checked").val() ? 1 : 0;
                var FifthSession = $("#FifthSession:checked").val() ? 1 : 0;
                var SixthSession = $("#SixthSession:checked").val() ? 1 : 0;
                var SeventhSession = $("#SeventhSession:checked").val() ? 1 : 0;
                var EighthSession = $("#EighthSession:checked").val() ? 1 : 0;

                formData.append('StudentID', StudentID);
                formData.append('AttendanceDate', AttendanceDate);
                formData.append('AttendanceType', AttendanceType);
                formData.append('AbsenceReason', AbsenceReason);
                formData.append('Description', Description);
                formData.append('ParentInformed', ParentInformed);
                formData.append('ParentMessage', ParentMessage);
                formData.append('AttendanceNote', AttendanceNote);
                formData.append('FirstSession', FirstSession);
                formData.append('SecondSession', SecondSession);
                formData.append('ThirdSession', ThirdSession);
                formData.append('FourthSession', FourthSession);
                formData.append('FifthSession', FifthSession);
                formData.append('SixthSession', SixthSession);
                formData.append('SeventhSession', SeventhSession);
                formData.append('EighthSession', EighthSession);

                $.ajax({
                    type: "POST",
                    url: "AddAttendance",
                    data: formData,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success: function (response) {
                        if (response.Success) {
                            $("#btnsave").attr("disabled", "disabled");
                            $.toast({
                                text: 'تمت عملية الحفظ بنجاح',
                                position: 'top-center',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                hideAfter: 1000,
                                stack: 6
                            });
                            window.setTimeout(function () {
                                //window.location.href.reload = '@Url.Action("PrepareAttendance", "Attendance")';
                                sessionStorage.setItem('refreshNeeded', 'true');
                                $("#back").click();

                            }, 1000);

                        } else {
                            Swal.fire(
                                'Error',
                                'Something went wrong\n ' + response.Message +'',
                                'error'
                            );
                        }
                    }
                });
            }
        });
    });

    function formatDate(date) {
        var d = new Date(date);
        var day = ('0' + d.getDate()).slice(-2);
        var month = ('0' + (d.getMonth() + 1)).slice(-2);
        var year = d.getFullYear();
        return day + '/' + month + '/' + year;
    }
</script>